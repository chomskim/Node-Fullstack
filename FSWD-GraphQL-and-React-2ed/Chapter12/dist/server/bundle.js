(()=>{var e={651:e=>{e.exports={development:{username:"devuser",password:"PASSWORD",database:"graphbook_dev",host:"localhost",dialect:"mysql",pool:{max:5,min:0,acquire:3e4,idle:1e4}},production:{host:process.env.host,username:process.env.username,password:process.env.password,database:process.env.database,logging:!1,dialect:"mysql",pool:{max:5,min:0,acquire:3e4,idle:1e4}}}},943:(e,t,n)=>{"use strict";var r=n(315),a=n(827),s=n(317),o=n(867),i=n(168);var c=n(121).Model;e.exports=function(e,t){var n=function(e){s(u,e);var t,n,c=(t=u,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=i(t);if(n){var a=i(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return o(this,e)});function u(){return r(this,u),c.apply(this,arguments)}return a(u,null,[{key:"associate",value:function(e){this.belongsToMany(e.User,{through:"users_chats"}),this.hasMany(e.Message)}}]),u}(c);return n.init({firstName:t.STRING,lastName:t.STRING,email:t.STRING},{sequelize:e,modelName:"Chat"}),n}},138:(e,t,n)=>{"use strict";var r=n(315),a=n(827),s=n(317),o=n(867),i=n(168);var c=n(121).Model;e.exports=function(e,t){var n=function(e){s(u,e);var t,n,c=(t=u,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=i(t);if(n){var a=i(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return o(this,e)});function u(){return r(this,u),c.apply(this,arguments)}return a(u,null,[{key:"associate",value:function(e){this.belongsTo(e.User),this.belongsTo(e.Chat)}}]),u}(c);return n.init({text:t.STRING,userId:t.INTEGER,chatId:t.INTEGER},{sequelize:e,modelName:"Message"}),n}},439:(e,t,n)=>{"use strict";var r=n(315),a=n(827),s=n(317),o=n(867),i=n(168);var c=n(121).Model;e.exports=function(e,t){var n=function(e){s(u,e);var t,n,c=(t=u,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=i(t);if(n){var a=i(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return o(this,e)});function u(){return r(this,u),c.apply(this,arguments)}return a(u,null,[{key:"associate",value:function(e){this.belongsTo(e.User)}}]),u}(c);return n.init({text:t.TEXT,userId:t.INTEGER},{sequelize:e,modelName:"Post"}),n}},951:(e,t,n)=>{"use strict";var r=n(315),a=n(827),s=n(317),o=n(867),i=n(168);var c=n(121).Model;e.exports=function(e,t){var n=function(e){s(u,e);var t,n,c=(t=u,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=i(t);if(n){var a=i(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return o(this,e)});function u(){return r(this,u),c.apply(this,arguments)}return a(u,null,[{key:"associate",value:function(e){this.hasMany(e.Post),this.belongsToMany(e.Chat,{through:"users_chats"})}}]),u}(c);return n.init({avatar:t.STRING,username:t.STRING,email:t.STRING,password:t.STRING},{sequelize:e,modelName:"User"}),n}},298:(e,t,n)=>{var r={"./chat.js":943,"./message.js":138,"./post.js":439,"./user.js":951};function a(e){var t=s(e);return n(t)}function s(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=s,e.exports=a,a.id=298},315:e=>{"use strict";e.exports=require("@babel/runtime/helpers/classCallCheck")},827:e=>{"use strict";e.exports=require("@babel/runtime/helpers/createClass")},168:e=>{"use strict";e.exports=require("@babel/runtime/helpers/getPrototypeOf")},317:e=>{"use strict";e.exports=require("@babel/runtime/helpers/inherits")},867:e=>{"use strict";e.exports=require("@babel/runtime/helpers/possibleConstructorReturn")},121:e=>{"use strict";e.exports=require("sequelize")}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=require("@babel/runtime/helpers/asyncToGenerator");var t=n.n(e);const r=require("@babel/runtime/regenerator");var a=n.n(r);const s=require("express");var o=n.n(s);const i=require("path");var c=n.n(i);const u=require("helmet");var l=n.n(u);const d=require("cors");var p=n.n(d);const m=require("compression");var f=n.n(m);const g=require("graphql-upload"),h=require("@babel/runtime/helpers/typeof");var v=n.n(h);const y=require("apollo-server-express"),b=require("@graphql-tools/schema"),E=require("@babel/runtime/helpers/defineProperty");var w=n.n(E);const S=require("winston");var O=n.n(S),q=[new(O().transports.File)({filename:"error.log",level:"error"}),new(O().transports.File)({filename:"combined.log",level:"verbose"})];const x=O().createLogger({level:"info",format:O().format.json(),transports:q});var P=n(121),k=n.n(P);const I=require("bcrypt");var j=n.n(I);const R=require("jsonwebtoken");var C=n.n(R);const N=require("aws-sdk");var D=n.n(N);const M=require("graphql-subscriptions");function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){w()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var U=new M.PubSub,L=new(D().S3)({signatureVersion:"v4",region:"eu-central-1"}),_=k().Op,F=process.env.JWT_SECRET;function $(){var e=this.db.models,n=e.Post,r=e.User,s=e.Chat,o=e.Message;return{Upload:g.GraphQLUpload,Post:{user:function(e,t,n){return e.getUser()}},Message:{user:function(e,t,n){return e.getUser()},chat:function(e,t,n){return e.getChat()}},Chat:{lastMessage:function(e,t,n){return e.getMessages({limit:1,order:[["id","DESC"]]}).then((function(e){return e[0]}))},messages:function(e,t,n){return e.getMessages({order:[["id","ASC"]]})},users:function(e,t,n){return e.getUsers()}},RootQuery:{usersSearch:function(e,t,n){var a=t.page,s=t.limit,o=t.text;if(o.length<3)return{users:[]};var i=0;a&&s&&(i=a*s);var c={order:[["createdAt","DESC"]],offset:i};return s&&(c.limit=s),c.where={username:w()({},_.like,"%"+o+"%")},{users:r.findAll(c)}},user:function(e,t,n){var a=t.username;return r.findOne({where:{username:a}})},postsFeed:function(e,t,a){var s=t.page,o=t.limit,i=t.username,c=0;s&&o&&(c=s*o);var u={order:[["createdAt","DESC"]],offset:c};return o&&(u.limit=o),i&&(u.include=[{model:r}],u.where={"$User.username$":i}),{posts:n.findAll(u)}},posts:function(e,t,r){return n.findAll({order:[["createdAt","DESC"]]})},chats:function(e,t,n){return s.findAll({include:[{model:r,required:!0,through:{where:{userId:n.user.id}}},{model:o}]})},chat:function(e,t,n){var a=t.chatId;return s.findByPk(a,{include:[{model:r,required:!0},{model:o}]})},currentUser:function(e,t,n){return n.user}},RootSubscription:{messageAdded:{subscribe:(0,M.withFilter)((function(){return U.asyncIterator("messageAdded")}),(function(e,t,n){return e.messageAdded.UserId!==n.user.id&&s.findOne({where:{id:e.messageAdded.ChatId},include:[{model:r,required:!0,through:{where:{userId:n.user.id}}}]}).then((function(e){return null!==e}))}))}},RootMutation:{addMessage:function(e,t,n){var r=t.message;return x.log({level:"info",message:"Message was created"}),o.create(T({},r)).then((function(e){return Promise.all([e.setUser(n.user.id),e.setChat(r.chatId)]).then((function(){return U.publish("messageAdded",{messageAdded:e}),e}))}))},logout:function(e,t,n){return n.cookies.set("authorization","",{signed:!0,expires:new Date,httpOnly:!0,secure:!1,sameSite:"strict"}),{message:!0}},signup:function(e,n,s){var o=n.email,i=n.password,c=n.username;return r.findAll({where:w()({},_.or,[{email:o},{username:c}]),raw:!0}).then(function(){var e=t()(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.length){e.next=4;break}throw new Error("User already exists");case 4:return e.abrupt("return",j().hash(i,10).then((function(e){return r.create({email:o,password:e,username:c,activated:1}).then((function(e){var t=C().sign({email:o,id:e.id},F,{expiresIn:"1d"}),n=new Date;return n.setDate(n.getDate()+1),s.cookies.set("authorization",t,{signed:!0,expires:n,httpOnly:!0,secure:!1,sameSite:"strict"}),{token:t}}))})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},login:function(e,n,s){var o=n.email,i=n.password;return r.findAll({where:{email:o},raw:!0}).then(function(){var e=t()(a().mark((function e(t){var n,r,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.length=1)){e.next=14;break}return n=t[0],e.next=4,j().compare(i,n.password);case 4:if(e.sent){e.next=7;break}throw new Error("Password does not match");case 7:return r=C().sign({email:o,id:n.id},F,{expiresIn:"1d"}),(c=new Date).setDate(c.getDate()+1),s.cookies.set("authorization",r,{signed:!0,expires:c,httpOnly:!0,secure:!1,sameSite:"strict"}),e.abrupt("return",{token:r});case 14:throw new Error("User not found");case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},addChat:function(e,t,n){var r=t.chat;return s.create().then((function(e){return Promise.all([e.setUsers(r.users)]).then((function(){return x.log({level:"info",message:"Message was created"}),e}))}))},uploadAvatar:function(e,n,s){return t()(a().mark((function e(){var t,o,i,c,u,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.file,e.next=3,t;case 3:return o=e.sent,i=o.createReadStream,c=o.filename,o.mimetype,o.encoding,u={Bucket:"apollo-book",Key:s.user.id+"/"+c,ACL:"public-read",Body:i()},e.next=12,L.upload(u).promise();case 12:return l=e.sent,e.abrupt("return",r.update({avatar:l.Location},{where:{id:s.user.id}}).then((function(){return{filename:c,url:l.Location}})));case 14:case"end":return e.stop()}}),e)})))()},addPost:function(e,t,a){var s=t.post;return r.findAll().then((function(e){var t=e[0];return n.create(T({},s)).then((function(e){return Promise.all([e.setUser(t.id)]).then((function(){return x.log({level:"info",message:"Post was created"}),e}))}))}))},deletePost:function(e,t,r){var a=t.postId;return n.destroy({where:{id:a}}).then((function(e){return 1===e?(x.log({level:"info",message:"Post "+a+"was deleted"}),{success:!0}):{success:!1}}),(function(e){x.log({level:"error",message:e.message})}))}}}}const B=["\n  directive @auth on QUERY | FIELD_DEFINITION | FIELD\n  scalar Upload\n\n  type File {\n    filename: String!\n    mimetype: String!\n    encoding: String!\n    url: String!\n  }\n\n  type Post {\n    id: Int\n    text: String\n    user: User\n  }\n\n  type User {\n    id: Int\n    avatar: String\n    username: String\n  }\n\n  type Message {\n    id: Int\n    text: String\n    chat: Chat\n    user: User\n  }\n\n  type Chat {\n    id: Int\n    messages: [Message]\n    lastMessage: Message\n    users: [User]\n  }\n\n  type PostFeed {\n    posts: [Post]\n  }\n\n  type RootQuery {\n    user(username: String!): User @auth\n    currentUser: User @auth\n    posts: [Post]\n    chats: [Chat] @auth\n    chat(chatId: Int): Chat\n    postsFeed(page: Int, limit: Int, username: String): PostFeed @auth\n    usersSearch(page: Int, limit: Int, text: String!): UsersSearch\n  }\n\n  input PostInput {\n    text: String!\n  }\n\n  input ChatInput {\n    users: [Int]\n  }\n\n  input MessageInput {\n    text: String!\n    chatId: Int!\n  }\n\n  type Response {\n    success: Boolean\n  }\n\n  type UsersSearch {\n    users: [User]\n  }\n\n  type Auth {\n    token: String\n  }\n\n  type RootMutation {\n    addPost (\n      post: PostInput!\n    ): Post @auth\n    addChat (\n      chat: ChatInput!\n    ): Chat @auth\n    addMessage (\n      message: MessageInput!\n    ): Message @auth\n    deletePost (\n      postId: Int!\n    ): Response\n    login (\n      email: String!\n      password: String!\n    ): Auth\n    signup (\n      username: String!\n      email: String!\n      password: String!\n    ): Auth\n    uploadAvatar (\n      file: Upload!\n    ): File @auth\n    logout: Response @auth\n  }\n\n  type RootSubscription {\n    messageAdded: Message\n  }\n\n  schema {\n    query: RootQuery\n    mutation: RootMutation\n    subscription: RootSubscription\n  }\n"],Q=require("@graphql-tools/utils"),z=function(e){var t={};return{authDirectiveTypeDefs:"directive @".concat(e," on QUERY | FIELD_DEFINITION | FIELD"),authDirectiveTransformer:function(n){var r;return(0,Q.mapSchema)(n,(r={},w()(r,Q.MapperKind.TYPE,(function(r){var a,s=null===(a=(0,Q.getDirective)(n,r,e))||void 0===a?void 0:a[0];s&&(t[r.name]=s)})),w()(r,Q.MapperKind.OBJECT_FIELD,(function(r,a,s){var o,i;if(null!==(o=null===(i=(0,Q.getDirective)(n,r,e))||void 0===i?void 0:i[0])&&void 0!==o?o:t[s]){var c=r.resolve,u=void 0===c?defaultFieldResolver:c;return r.resolve=function(e,t,n,r){if(n.user)return u(e,t,n,r);throw new Error("You need to be logged in.")},r}})),r))}}};var G=process.env.JWT_SECRET;const W=function(e){var n,r=z("auth"),s=r.authDirectiveTypeDefs,o=r.authDirectiveTransformer,i=(0,b.makeExecutableSchema)({typeDefs:[s,B],resolvers:$.call(e)});return i=o(i),new y.ApolloServer({schema:i,context:(n=t()(a().mark((function t(n){var r,s,o,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.req,s=r.headers.authorization,"undefined"===v()(s)){t.next=9;break}return o=new RegExp("Bearer","ig"),i=s.replace(o,"").trim(),t.abrupt("return",C().verify(i,G,(function(t,n){return t?r:e.db.models.User.findByPk(n.id).then((function(e){return Object.assign({},r,{user:e})}))})));case 9:return t.abrupt("return",r);case 10:case"end":return t.stop()}}),t)}))),function(e){return n.apply(this,arguments)})})},H=require("subscriptions-transport-ws"),J=require("graphql");var Y=process.env.JWT_SECRET;const K=function(e){return function(n){var r,s=(0,b.makeExecutableSchema)({typeDefs:B,resolvers:$.call(e),schemaDirectives:{auth:z}});new H.SubscriptionServer({execute:J.execute,subscribe:J.subscribe,schema:s,onConnect:(r=t()(a().mark((function t(n,r){var s,o,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=n.authToken,"undefined"===v()(s)){t.next=8;break}return o=new RegExp("Bearer","ig"),i=s.replace(o,"").trim(),t.abrupt("return",C().verify(i,Y,(function(t,n){if(t)throw new Error("Missing auth token!");return e.db.models.User.findByPk(n.id).then((function(e){return Object.assign({},r.upgradeReq,{user:e})}))})));case 8:throw new Error("Missing auth token!");case 9:case"end":return t.stop()}}),t)}))),function(e,t){return r.apply(this,arguments)})},{server:n,path:"/subscriptions"})}};var X=n(651),V=n.n(X)().production,Z=new(k())(V.database,V.username,V.password,V);const ee={models:function(e){var t={},r=n(298);return r.keys().map(r).forEach((function(n){var r=n(e,k());t[r.name]=r})),Object.keys(t).forEach((function(e){t[e].associate&&t[e].associate(t)})),t}(Z),sequelize:Z},te=require("@apollo/client"),ne=require("@apollo/client/link/error"),re=require("node-fetch");var ae=n.n(re);function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?se(Object(n),!0).forEach((function(t){w()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const ie=function(e,t){return new te.ApolloClient({ssrMode:!0,link:(0,te.from)([(0,ne.onError)((function(e){var t=e.graphQLErrors,n=e.networkError;t&&(t.map((function(e){e.message,e.locations,e.path,e.extensions})),n&&console.log("[Network error]: ".concat(n)))})),function(n,r){return t&&n.setContext((function(t){return oe(oe({},t),{},{headers:oe(oe({},t.headers),{},{Authorization:e.cookies.get("authorization")})})})),r(n)},new te.HttpLink({uri:"http://localhost:8000/graphql",credentials:"same-origin",fetch:ae()})]),cache:new te.InMemoryCache})},ce=require("react");var ue=n.n(ce);const le=require("react-dom/server");var de=n.n(le);const pe=require("@babel/runtime/helpers/slicedToArray");var me=n.n(pe);const fe=require("react-helmet"),ge=require("@apollo/client/react/hoc"),he=require("@babel/runtime/helpers/objectWithoutProperties");var ve=n.n(he);const ye=require("@babel/runtime/helpers/extends");var be=n.n(ye);const Ee=require("react-router-dom"),we=require("@babel/runtime/helpers/taggedTemplateLiteral");var Se,Oe,qe=n.n(we),xe=(0,te.gql)(Se||(Se=qe()(["\n  mutation login($email : String!, $password : String!) {\n    login(email : $email, password : $password) {\n      token\n    }\n  }\n"]))),Pe=(0,te.gql)(Oe||(Oe=qe()(["\n  mutation signup($email : String!, $password : String!, $username : String!) {\n    signup(email : $email, password : $password, username : $username) {\n      token\n    }\n  }\n"])));const ke=function(e){var t=e.color,n=e.size,r={backgroundColor:"#6ca6fd",width:40,height:40};return"undefined"!==v()(t)&&(r.color=t),"undefined"!==v()(n)&&(r.width=n,r.height=n),ue().createElement("div",{className:"bouncer",style:r})},Ie=function(e){var t=e.children;return ue().createElement("div",{className:"error message"},t)};var je=function(e){var t=e.changeLoginState,n=(0,ce.useState)(""),r=me()(n,2),a=r[0],s=r[1],o=(0,ce.useState)(""),i=me()(o,2),c=i[0],u=i[1],l=(0,te.useMutation)(xe),d=me()(l,2),p=d[0],m=d[1],f=m.loading,g=m.error;return ue().createElement("div",{className:"login"},!f&&ue().createElement("form",{onSubmit:function(e){e.preventDefault(),p({update:function(e,n){var r=n.data.login;r.token&&(localStorage.setItem("jwt",r.token),t(!0))},variables:{email:a,password:c}})}},ue().createElement("label",null,"Email"),ue().createElement("input",{type:"text",onChange:function(e){return s(e.target.value)}}),ue().createElement("label",null,"Password"),ue().createElement("input",{type:"password",onChange:function(e){return u(e.target.value)}}),ue().createElement("input",{type:"submit",value:"Login"})),f&&ue().createElement(ke,null),g&&ue().createElement(Ie,null,ue().createElement("p",null,"There was an error logging in!")))},Re=function(e){var t=e.changeLoginState,n=(0,ce.useState)(""),r=me()(n,2),a=r[0],s=r[1],o=(0,ce.useState)(""),i=me()(o,2),c=i[0],u=i[1],l=(0,ce.useState)(""),d=me()(l,2),p=d[0],m=d[1],f=(0,te.useMutation)(Pe),g=me()(f,2),h=g[0],v=g[1],y=v.loading,b=v.error;return ue().createElement("div",{className:"login"},!y&&ue().createElement("form",{onSubmit:function(e){e.preventDefault(),h({update:function(e,n){var r=n.data.login;r.token&&(localStorage.setItem("jwt",r.token),t(!0))},variables:{email:a,password:c,username:p}})}},ue().createElement("label",null,"Email"),ue().createElement("input",{type:"text",onChange:function(e){return s(e.target.value)}}),ue().createElement("label",null,"Username"),ue().createElement("input",{type:"text",onChange:function(e){return m(e.target.value)}}),ue().createElement("label",null,"Password"),ue().createElement("input",{type:"password",onChange:function(e){return u(e.target.value)}}),ue().createElement("input",{type:"submit",value:"Sign up"})),y&&ue().createElement(ke,null),b&&ue().createElement(Ie,null,ue().createElement("p",null,"There was an error logging in!")))};const Ce=function(e){var t=e.changeLoginState,n=(0,ce.useState)(!0),r=me()(n,2),a=r[0],s=r[1];return ue().createElement("div",{className:"authModal"},a&&ue().createElement("div",null,ue().createElement(je,{changeLoginState:t}),ue().createElement("a",{onClick:function(){return s(!1)}},"Want to sign up? Click here")),!a&&ue().createElement("div",null,ue().createElement(Re,{changeLoginState:t}),ue().createElement("a",{onClick:function(){return s(!0)}},"Want to login? Click here")))},Ne=require("@babel/runtime/helpers/toConsumableArray");var De=n.n(Ne);const Me=require("react-infinite-scroll-component");var Ae=n.n(Me);const Te=function(e){var t,n=e.trigger,r=e.children,a=(0,ce.useState)(!1),s=me()(a,2),o=s[0],i=s[1],c=(0,ce.useRef)(null);return t=c,(0,ce.useEffect)((function(){function e(e){t.current&&!t.current.contains(e.target)&&i(!1)}return document.addEventListener("mousedown",e),function(){document.removeEventListener("mousedown",e)}}),[t]),ue().createElement("div",{className:"dropdown"},ue().createElement("div",null,ue().createElement("div",{className:"trigger",onClick:function(){return i(!o)}},n),ue().createElement("div",{ref:c},o&&ue().createElement("div",{className:"content"},r))))},Ue=require("@fortawesome/react-fontawesome");var Le;function _e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_e(Object(n),!0).forEach((function(t){w()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_e(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $e=(0,te.gql)(Le||(Le=qe()(["\n  mutation deletePost($postId : Int!) {\n    deletePost(postId : $postId) {\n      success\n    }\n  }\n"])));const Be=function(e){var t,n=e.post,r=(t=n.id,(0,te.useMutation)($e,function(e){return{update:function(t,n){n.data.deletePost.success&&t.modify({fields:{postsFeed:function(t,n){var r=n.readField;return Fe(Fe({},t),{},{posts:t.posts.filter((function(t){return e!==r("id",t)}))})}}})}}}(t))),a=me()(r,1)[0];return ue().createElement("div",{className:"header"},ue().createElement(Ee.Link,{to:"/user/"+n.user.username},ue().createElement("img",{src:n.user.avatar}),ue().createElement("div",null,ue().createElement("h2",null,n.user.username))),ue().createElement(Te,{trigger:ue().createElement(Ue.FontAwesomeIcon,{icon:"angle-down"})},ue().createElement("button",{onClick:function(){return a({variables:{postId:n.id}})}},"Delete")))},Qe=function(e){var t=e.post;return ue().createElement("p",{className:"content"},t.text)},ze=require("prop-types");var Ge=n.n(ze),We=function(e){var t=e.post;return ue().createElement("div",{className:"post "+(t.id<0?"optimistic":"")},ue().createElement(Be,{post:t}),ue().createElement(Qe,{post:t}))};We.propTypes={post:Ge().shape({id:Ge().number.isRequired,text:Ge().string.isRequired,user:Ge().shape({avatar:Ge().string.isRequired,username:Ge().string.isRequired}).isRequired}).isRequired};const He=We,Je=function(e){var t=e.fetchMore,n=e.posts,r=(0,ce.useState)(!0),a=me()(r,2),s=a[0],o=a[1],i=(0,ce.useState)(0),c=me()(i,2),u=c[0],l=c[1];return ue().createElement("div",{className:"feed"},ue().createElement(Ae(),{dataLength:n.length,next:function(){return function(e){e({variables:{page:u+1},updateQuery:function(e,t){var n=t.fetchMoreResult;return n.postsFeed.posts.length?(l(u+1),{postsFeed:{__typename:"PostFeed",posts:[].concat(De()(e.postsFeed.posts),De()(n.postsFeed.posts))}}):(o(!1),e)}})}(t)},hasMore:s,loader:ue().createElement("div",{className:"loader",key:"loader"},"Loading ...")},n.map((function(e,t){return ue().createElement(He,{key:e.id,post:e})}))))};var Ye,Ke,Xe=(0,te.gql)(Ye||(Ye=qe()(["\n  fragment userAttributes on User {\n    id\n    username\n    avatar\n  }\n"])));function Ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ve(Object(n),!0).forEach((function(t){w()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var et,tt,nt=(0,te.gql)(Ke||(Ke=qe()(["\n  query postsFeed($page: Int, $limit: Int, $username: String) {\n    postsFeed(page: $page, limit: $limit, username: $username) {\n      posts {\n        id\n        text\n        user {\n          ...userAttributes\n        }\n      }\n    }\n  }\n  ","\n"])),Xe),rt=function(e){return(0,te.useQuery)(nt,{pollInterval:5e3,variables:Ze({page:0,limit:10},e)})};function at(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function st(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?at(Object(n),!0).forEach((function(t){w()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):at(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ot=(0,te.gql)(et||(et=qe()(["\n  mutation addPost($post : PostInput!) {\n    addPost(post : $post) {\n      id\n      text\n      user {\n        ...userAttributes\n      }\n    }\n  }\n  ","\n"])),Xe);const it=function(){var e=(0,ce.useState)(""),t=me()(e,2),n=t[0],r=t[1],a=(0,ce.useState)(0),s=me()(a,2),o=s[0],i=s[1],c=rt(),u=c.loading,l=c.error,d=c.data,p=c.fetchMore,m=function(e){return(0,te.useMutation)(ot,function(e){return{optimisticResponse:{__typename:"mutation",addPost:{__typename:"Post",text:e,id:-1,user:{__typename:"User",username:"Loading...",avatar:"/public/loading.gif"}}},update:function(e,t){var n=t.data.addPost;e.modify({fields:{postsFeed:function(t){var r=t.posts,a=e.writeFragment({data:n,fragment:(0,te.gql)(tt||(tt=qe()(["\n              fragment NewPost on Post {\n                id\n                type\n              }\n            "])))});return st(st({},t),{},{posts:[a].concat(De()(r))})}}})}}}(e))}(n),f=me()(m,1)[0];if(u)return ue().createElement(ke,null);if(l)return ue().createElement(Ie,null,ue().createElement("p",null,l.message));var g=d.postsFeed.posts;return ue().createElement("div",{className:"container"},ue().createElement("div",{className:"postForm"},ue().createElement("form",{onSubmit:function(e){e.preventDefault(),f({variables:{post:{text:n}}}),r("")}},ue().createElement("textarea",{value:n,onChange:function(e){return r(e.target.value)},placeholder:"Write your custom post!"}),ue().createElement("input",{type:"submit",value:"Submit"}))),ue().createElement(Je,{posts:g,fetchMore:function(){p({variables:{page:o+1},updateQuery:function(e,t){var n=t.fetchMoreResult;return n.postsFeed.posts.length?(i(o+1),{postsFeed:{__typename:"PostFeed",posts:[].concat(De()(e.postsFeed.posts),De()(n.postsFeed.posts))}}):(setHasMore(!1),e)}})}}))};var ct,ut,lt,dt=(0,te.gql)(ct||(ct=qe()(["\n  query chat($chatId: Int!) {\n    chat(chatId: $chatId) {\n      id\n      users {\n        id\n        ...userAttributes\n      }\n      messages {\n        id\n        text\n        user {\n            id\n        }\n      }\n    }\n  }\n  ","\n"])),Xe),pt=(0,te.gql)(ut||(ut=qe()(["\n  mutation addMessage($message : MessageInput!) {\n    addMessage(message : $message) {\n      id\n      text\n      user {\n        id\n      }\n    }\n  }\n"]))),mt=(0,te.gql)(lt||(lt=qe()(["\n  fragment NewMessage on Chat {\n      id\n      type\n  }\n"])));const ft=function(e){var t=e.chatId,n=e.closeChat,r=function(e){return(0,te.useQuery)(dt,{variables:{chatId:e}})}(t),a=r.loading,s=r.error,o=r.data,i=(0,ce.useState)(""),c=me()(i,2),u=c[0],l=c[1],d=function(e){return(0,te.useMutation)(pt,function(e){return{update:function(t,n){var r=n.data.addMessage;t.modify({id:t.identify(e.chat),fields:{messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=t.writeFragment({data:r,fragment:mt});return[].concat(De()(e),[n])}}})}}}(e))}(o),p=me()(d,1)[0];if(a)return ue().createElement(ke,null);if(s)return ue().createElement("div",{className:"chatWindow"},ue().createElement(ke,null,ue().createElement("p",null,s.message)));var m=o.chat;return ue().createElement("div",{className:"chatWindow"},ue().createElement("div",{className:"header"},ue().createElement("span",null,m.users[1].username),ue().createElement("button",{onClick:function(){return n(t)},className:"close"},"X")),ue().createElement("div",{className:"messages"},m.messages.map((function(e,t){return ue().createElement("div",{key:"message"+e.id,className:"message "+(e.user.id>1?"left":"right")},e.text)}))),ue().createElement("div",{className:"input"},ue().createElement("input",{type:"text",value:u,onChange:function(e){return l(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&u.length&&p({variables:{message:{text:u,chatId:t}}}).then((function(){l("")}))}})))};var gt,ht,vt=(0,te.gql)(gt||(gt=qe()(["\n  query chats {\n    chats {\n      id\n      users {\n        id\n        ...userAttributes\n      }\n      lastMessage {\n        text\n      }\n    }\n  }\n  ","\n"])),Xe),yt=(0,te.gql)(ht||(ht=qe()(["\nsubscription onMessageAdded {\n  messageAdded {\n    id\n    text\n    chat {\n      id\n    }\n    user {\n      id\n      __typename\n    }\n    __typename\n  }\n}\n"])));const bt=require("react-toastify");var Et,wt,St=(0,te.gql)(Et||(Et=qe()(["\n  subscription onMessageAdded {\n    messageAdded {\n      id\n      text\n      chat {\n        id\n      }\n      user {\n        id\n        __typename\n      }\n      __typename\n    }\n  }\n"]))),Ot=(0,te.gql)(wt||(wt=qe()(["\n  query currentUser {\n    currentUser {\n      id\n      username\n      avatar\n    }\n  }\n"]))),qt=function(e){var t=e.children;return ue().createElement(te.ApolloConsumer,null,(function(e){var n=e.readQuery({query:Ot});return ue().Children.map(t,(function(e){return ue().cloneElement(e,{user:null!=n&&n.currentUser?n.currentUser:null})}))}))},xt=function(e){return e.length?e.length>12?e.substring(0,e.length-9)+"...":e:""},Pt=function(e,t){return t.length>2?"/public/group.png":t[0].id!==e.id?t[0].avatar:t[1].avatar};const kt=function(e){var t=e.user,n=e.chat,r=e.openChat;return ue().createElement("div",{key:n.id,className:"chat",onClick:function(){return r(n.id)}},ue().createElement("div",{className:"header"},ue().createElement("img",{src:Pt(t,n.users)}),ue().createElement("div",null,ue().createElement("h2",null,xt(function(e,t){for(var n="",r=0;r<t.length;r++)t[r].username!==e.username&&(n+=t[r].username),r-1===t.length&&(n+=", ");return n}(t,n.users))),ue().createElement("span",null,xt(n.lastMessage.text)))))};var It=function(e){var t,n=e.client,r=e.user,a=(0,te.useQuery)(vt),s=a.loading,o=a.error,i=a.data,c=a.subscribeToMore,u=(0,ce.useState)([]),l=me()(u,2),d=l[0],p=l[1];t={onSubscriptionData:function(e){e&&e.subscriptionData&&e.subscriptionData.data&&e.subscriptionData.data.messageAdded&&(0,bt.toast)(e.subscriptionData.data.messageAdded.text,{position:bt.toast.POSITION.TOP_LEFT})}},(0,te.useSubscription)(St,t);var m=function(e){var t=d.slice();-1===t.indexOf(e)&&(t.length>2&&(t=t.slice(1)),t.push(e)),p(t)};(0,ce.useEffect)((function(){c({document:yt,updateQuery:function(e,t){var a=t.subscriptionData;if(!a.data||!e.chats||!e.chats.length)return e;for(var s=-1,o=0;o<e.chats.length;o++)if(e.chats[o].id==a.data.messageAdded.chat.id){s=o;break}if(-1===s)return e;var i=Object.assign({},e.chats[o],{lastMessage:{text:a.data.messageAdded.text,__typename:a.data.messageAdded.__typename}});if(r.id!==a.data.messageAdded.user.id)try{var c=n.readQuery({query:dt,variables:{chatId:a.data.messageAdded.chat.id}});n.cache.modify({id:n.cache.identify(c.chat),fields:{messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=n.cache.writeFragment({data:a.data.messageAdded,fragment:mt});return[].concat(De()(e),[t])}}})}catch(e){}var u={chats:De()(e.chats)};return u.chats[o]=i,u}})}),[]);var f=function(e){var t=d.slice(),n=t.indexOf(e);t.splice(n,1),p(t)};if(s)return ue().createElement(ke,null);if(o)return ue().createElement("div",{className:"chats"},ue().createElement(ke,null,ue().createElement("p",null,o.message)));var g=i.chats;return ue().createElement("div",{className:"wrapper"},ue().createElement(bt.ToastContainer,null),ue().createElement("div",{className:"chats"},g.map((function(e,t){return ue().createElement(kt,{key:"chatItem"+e.id,chat:e,user:r,openChat:m})}))),ue().createElement("div",{className:"openChats"},d.map((function(e,t){return ue().createElement(ft,{chatId:e,key:"chatWindow"+e,closeChat:f})}))))};const jt=(0,ge.withApollo)((function(e){return ue().createElement(qt,null,ue().createElement(It,e))}));var Rt,Ct=(0,te.gql)(Rt||(Rt=qe()(["\n  query usersSearch($page: Int, $limit: Int, $text: String!) {\n    usersSearch(page: $page, limit: $limit, text: $text) {\n      users {\n        id\n        ...userAttributes\n      }\n    }\n  }\n  ","\n"])),Xe);const Nt=function(e){var t=e.data.usersSearch.users,n=(0,ce.useState)(!1),r=me()(n,2),a=r[0],s=r[1],o=function e(t){t?document.addEventListener("click",e.bind(null,!t),!0):document.removeEventListener("click",e.bind(null,!t),!0),s(t)};return(0,ce.useEffect)((function(){!function(e){e.length?o(!0):o(!1)}(t)}),[t]),(0,ce.useEffect)((function(){return function(){document.removeEventListener("click",o.bind(null,!a),!0)}})),a&&ue().createElement("div",{className:"result"},t.map((function(e,t){return ue().createElement("div",{key:e.id,className:"user"},ue().createElement("img",{src:e.avatar}),ue().createElement("span",null,e.username))})))},Dt=function(){var e=(0,ce.useState)(""),t=me()(e,2),n=t[0],r=t[1],a=function(e){return(0,te.useQuery)(Ct,function(e){return{variables:{page:0,limit:5,text:e},skip:e.length<3}}(e))}(n),s=a.loading,o=a.error,i=a.data;return ue().createElement("div",{className:"search"},ue().createElement("input",{type:"text",onChange:function(e){r(e.target.value)},value:n}),!s&&!o&&i&&ue().createElement(Nt,{data:i}))},Mt=require("react-modal");var At=n.n(Mt);const Tt=require("react-cropper");var Ut=n.n(Tt);const Lt=require("react-dropzone");var _t,Ft=(0,te.gql)(_t||(_t=qe()(["\n  mutation uploadAvatar($file: Upload!) {\n    uploadAvatar(file : $file) {\n      filename\n      url\n    }\n  }\n"])));At().setAppElement("#root");var $t={content:{width:"400px",height:"450px",top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)"}};const Bt=function(e){var t=e.isOpen,n=e.showModal,r=(0,ce.useState)(null),a=me()(r,2),s=a[0],o=a[1],i=(0,ce.useState)(null),c=me()(i,2),u=c[0],l=c[1],d=(0,te.useMutation)(Ft,{update:function(e,t){var n=t.data.uploadAvatar;n&&n.url&&e.modify({fields:{currentUser:function(t,r){r.readField,e.modify({id:t,fields:{avatar:function(){return n.url}}})}}})}}),p=me()(d,1)[0],m=(0,ce.useRef)(null),f=(0,Lt.useDropzone)({onDrop:function(e){var t=new FileReader;t.onload=function(){o({src:t.result,filename:e[0].name,filetype:e[0].type,result:t.result,error:null})},t.readAsDataURL(e[0])}}),g=f.getRootProps,h=f.getInputProps,v=f.isDragActive;return ue().createElement(At(),{isOpen:t,onRequestClose:n,contentLabel:"Change avatar",style:$t},!s&&ue().createElement("div",be()({className:"drop"},g()),ue().createElement("input",h()),v?ue().createElement("p",null,"Drop the files here ..."):ue().createElement("p",null,"Drag 'n' drop some files here, or click to select files")),s&&ue().createElement(Ut(),{ref:m,src:s.src,style:{height:400,width:"100%"},initialAspectRatio:16/9,guides:!1,crop:function(){var e=null==m?void 0:m.current,t=null==e?void 0:e.cropper;l(t.getCroppedCanvas().toDataURL())}}),s&&ue().createElement("button",{className:"cancelUpload",onClick:function(){o(null)}},"Change image"),ue().createElement("button",{className:"uploadAvatar",onClick:function(){var e=function(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(t.length),a=0;a<t.length;a++)r[a]=t.charCodeAt(a);return new Blob([r],{type:n})}(u);e.name=s.filename,p({variables:{file:e}}).then((function(){n()}))}},"Save"))},Qt=function(e){var t=e.user,n=(0,ce.useState)(!1),r=me()(n,2),a=r[0],s=r[1],o=function(){s(!a)};return t?ue().createElement("div",{className:"user"},ue().createElement("img",{src:t.avatar,onClick:function(){return o()}}),ue().createElement(Bt,{isOpen:a,showModal:o}),ue().createElement("span",null,t.username)):null};var zt,Gt=(0,te.gql)(zt||(zt=qe()(["\n  mutation logout {\n    logout {\n      success\n    }\n  }\n"])));const Wt=(0,ge.withApollo)((function(e){var t=e.changeLoginState,n=e.client,r=(0,te.useMutation)(Gt),a=me()(r,1)[0];return ue().createElement("button",{className:"logout",onClick:function(){a().then((function(){localStorage.removeItem("jwt"),t(!1),n.stop(),n.resetStore()}))}},"Logout")})),Ht=(0,require("react-router").withRouter)((function(e){var t=e.history;return ue().createElement("button",{className:"goHome",onClick:function(){t.push("/app")}},"Home")})),Jt=function(e){var t=e.changeLoginState;return ue().createElement("div",{className:"topbar"},ue().createElement("div",{className:"inner"},ue().createElement(Dt,null),ue().createElement(qt,null,ue().createElement(Qt,null))),ue().createElement("div",{className:"buttons"},ue().createElement(Ht,null),ue().createElement(Wt,{changeLoginState:t})))},Yt=function(e){var t=e.changeLoginState;return ue().createElement(ue().Fragment,null,ue().createElement(Jt,{changeLoginState:t}),ue().createElement(it,null),ue().createElement(jt,null))},Kt=function(e){var t=e.user,n=t.avatar,r=t.username;return ue().createElement("div",{className:"profileHeader"},ue().createElement("div",{className:"avatar"},ue().createElement("img",{src:n})),ue().createElement("div",{className:"information"},ue().createElement("p",null,r),ue().createElement("p",null,"You can provide further information here and build your really personal header component for your users.")))};var Xt;function Vt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vt(Object(n),!0).forEach((function(t){w()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var en=(0,te.gql)(Xt||(Xt=qe()(["\n  query user($username: String!) {\n    user(username: $username) {\n      ...userAttributes\n    }\n  }\n  ","\n"])),Xe);const tn=function(e){var t,n=e.username,r=(t={username:n},(0,te.useQuery)(en,{variables:Zt({},t)})),a=r.data,s=r.loading,o=rt({username:n}),i=o.loading,c=o.error,u=o.data,l=o.fetchMore;return i||s?ue().createElement(ke,null):c?ue().createElement(Ie,null,ue().createElement("p",null,c.message)):ue().createElement("div",{className:"user"},ue().createElement("div",{className:"inner"},ue().createElement(Kt,{user:a.user})),ue().createElement("div",{className:"container"},ue().createElement(Je,{posts:u.postsFeed.posts,fetchMore:l})))},nn=function(e){var t=e.changeLoginState,n=e.match;return ue().createElement(ue().Fragment,null,ue().createElement(Jt,{changeLoginState:t}),ue().createElement(tn,{username:n.params.username}),ue().createElement(jt,null))};var rn,an=["component"],sn=["component"];rn="undefined"!==("undefined"==typeof window?"undefined":v()(window))?Ee.BrowserRouter:Ee.StaticRouter;var on=function(e){var t=e.component,n=ve()(e,an);return ue().createElement(Ee.Route,be()({},n,{render:function(e){return!0===n.loggedIn?ue().createElement(t,e):ue().createElement(Ee.Redirect,{to:{pathname:"/",state:{from:e.location}}})}}))},cn=function(e){var t=e.component,n=ve()(e,sn);return ue().createElement(Ee.Route,be()({},n,{render:function(e){return!1===n.loggedIn?ue().createElement(t,e):ue().createElement(Ee.Redirect,{to:{pathname:"undefined"!==v()(e.location.state)?e.location.state.from.pathname:"/app"}})}}))},un=function(){return ue().createElement(Ee.Redirect,{to:"/"})};const ln=function(e){var t=e.changeLoginState,n=e.loggedIn,r=e.context,a=e.location;return ue().createElement(rn,{context:r,location:a},ue().createElement(Ee.Switch,null,ue().createElement(on,{path:"/app",component:function(){return ue().createElement(Yt,{changeLoginState:t})},loggedIn:n}),ue().createElement(on,{path:"/user/:username",component:function(e){return ue().createElement(nn,be()({},e,{changeLoginState:t}))},loggedIn:n}),ue().createElement(cn,{exact:!0,path:"/",component:function(){return ue().createElement(Ce,{changeLoginState:t})},loggedIn:n}),ue().createElement(Ee.Route,{component:un})))},dn=require("@fortawesome/fontawesome-svg-core"),pn=require("@fortawesome/free-solid-svg-icons");dn.library.add(pn.faAngleDown);const mn=(0,ge.withApollo)((function(e){var t=e.location,n=e.context,r=e.loggedIn,a=(0,te.useQuery)(Ot,undefined),s=(a.data,a.loading,a.error,(0,ce.useState)(r)),o=me()(s,2),i=o[0],c=o[1];return ue().createElement("div",{className:"container"},ue().createElement(fe.Helmet,null,ue().createElement("title",null,"Graphbook - Feed"),ue().createElement("meta",{name:"description",content:"Newsfeed of all your friends on Graphbook"})),ue().createElement(ln,{loggedIn:i,changeLoginState:c,location:t,context:n}))})),fn=function(e){var t=e.client,n=e.location,r=e.context,a=e.loggedIn;return ue().createElement(te.ApolloProvider,{client:t},ue().createElement(mn,{location:n,context:r,loggedIn:a}))},gn=function(e,t,n){return'\n    <html lang="en">\n      <head>\n        <meta charSet="UTF-8"/>\n        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>\n        <meta httpEquiv="X-UA-Compatible" content="ie=edge"/>\n        <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">\n        '.concat("<link rel='stylesheet' href='/bundle.css'/>","\n        ").concat(t.title.toString(),"\n        ").concat(t.meta.toString(),"\n      </head>\n      <body>\n        ").concat(de().renderToStaticMarkup(ue().createElement("div",{id:"root",dangerouslySetInnerHTML:{__html:e}})),"\n        ").concat(de().renderToStaticMarkup(ue().createElement("script",{dangerouslySetInnerHTML:{__html:"window.__APOLLO_STATE__=".concat(JSON.stringify(n).replace(/</g,"\\u003c"))}})),'\n        <script src="/bundle.js"><\/script>\n      </body>\n    </html>\n  ')},hn=require("cookies");var vn=n.n(hn);const yn=require("@apollo/client/react/ssr"),bn=require("http");var En,wn=process.env.JWT_SECRET,Sn={graphql:W(En={db:ee}),subscriptions:K(En)},On=c().join(__dirname,"../../"),qn=o()(),xn=(0,bn.createServer)(qn);qn.use(f()()),qn.use(l()()),qn.use(l().contentSecurityPolicy({directives:{defaultSrc:["'self'"],scriptSrc:["'self'","'unsafe-inline'"],styleSrc:["'self'","'unsafe-inline'"],imgSrc:["'self'","data:","*.amazonaws.com"]}})),qn.use(l().referrerPolicy({policy:"same-origin"})),qn.use((function(e,t,n){e.cookies=new(vn())(e,t,{keys:["Some random keys"]}),n()})),qn.use(p()()),qn.use("/uploads",o().static(c().join(On,"uploads"))),qn.use("/",o().static(c().join(On,"dist/client"),{index:!1})),qn.get("*",function(){var e=t()(a().mark((function e(t,n){var r,s,o,i,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.cookies.get("authorization",{signed:!0}),e.prev=1,e.next=4,C().verify(r,wn);case 4:s=!0,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),s=!1;case 10:o=ie(t,s),i={},c=ue().createElement(fn,{client:o,loggedIn:s,location:t.url,context:i}),(0,yn.renderToStringWithData)(c).then((function(e){var t=o.extract();if(i.url)n.redirect(301,i.url);else{var r=fe.Helmet.renderStatic();n.status(200),n.send("<!doctype html>\n".concat(gn(e,r,t))),n.end()}}));case 14:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n){return e.apply(this,arguments)}}());for(var Pn=Object.keys(Sn),kn=function(e){var n=Pn[e];switch(n){case"graphql":t()(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Sn[n].start();case 2:qn.use((0,g.graphqlUploadExpress)()),Sn[n].applyMiddleware({app:qn});case 4:case"end":return e.stop()}}),e)})))();break;case"subscriptions":xn.listen(8e3,(function(){Sn[n](xn)}));break;default:qn.use("/".concat(n),Sn[n])}},In=0;In<Pn.length;In+=1)kn(In)})()})();